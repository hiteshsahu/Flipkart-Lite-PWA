'use strict';

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

module.exports = function () {
	function PushManifestPlugin() {
		_classCallCheck(this, PushManifestPlugin);
	}

	PushManifestPlugin.prototype.apply = function apply(compiler) {
		compiler.plugin('emit', function (compilation, callback) {
			var manifest = {};

			for (var filename in compilation.assets) {
				if (/route-/.test(filename)) {
					var path = filename.replace(/route-/, '/').replace(/\.chunk(\.\w+)?\.js$/, '').replace(/\/home/, '/');
					manifest[path] = {
						"style.css": {
							"type": "style",
							"weight": 1
						},
						"bundle.js": {
							"type": "script",
							"weight": 1
						},
						[filename]: {
							"type": "script",
							"weight": .9
						}
					};
				}
			}

			var output = JSON.stringify(manifest);
			compilation.assets['push-manifest.json'] = {
				source() {
					return output;
				},
				size() {
					return output.length;
				}
			};

			callback();
		});
	};

	return PushManifestPlugin;
}();