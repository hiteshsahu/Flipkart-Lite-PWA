'use strict';

var _ava = require('ava');

var _ava2 = _interopRequireDefault(_ava);

var _core = require('@webpack-blocks/core');

var _devServer = require('../devServer');

var _devServer2 = _interopRequireDefault(_devServer);

var _webpack = require('../webpack');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const webpack = {
  HotModuleReplacementPlugin: function HotModuleReplacementPlugin() {}
};

(0, _ava2.default)('devServer() without options provides expected defaults', t => {
  const config = (0, _core.createConfig)({ webpack: webpack }, [(0, _webpack.entryPoint)({
    main: ['./test.js']
  }), (0, _devServer2.default)()]);

  t.deepEqual(config, {
    entry: {
      main: ['./test.js', 'webpack/hot/only-dev-server']
    },
    devServer: {
      hot: true,
      historyApiFallback: true,
      inline: true
    },
    plugins: [{}]
  });
  t.true(config.plugins[0] instanceof webpack.HotModuleReplacementPlugin);
});

(0, _ava2.default)('devServer() uses custom options and can be composed', t => {
  const config = (0, _core.createConfig)({ webpack: webpack }, [(0, _webpack.entryPoint)({
    main: ['./test.js'],
    second: ['./second.js']
  }), (0, _devServer2.default)({
    inline: false
  }), (0, _devServer2.default)('some-entry-point')]);

  t.deepEqual(config, {
    entry: {
      main: ['./test.js', 'some-entry-point'],
      second: ['./second.js', 'some-entry-point']
    },
    devServer: {
      hot: true,
      historyApiFallback: true,
      inline: false
    },
    plugins: [{}]
  });
  t.true(config.plugins[0] instanceof webpack.HotModuleReplacementPlugin);
});

// Regression test for https://github.com/andywer/webpack-blocks/issues/76
(0, _ava2.default)('devServer block extends multiple entry points correctly', t => {
  const config = (0, _core.createConfig)({ webpack: webpack }, [(0, _webpack.entryPoint)({
    a: './a',
    b: ['./b']
  }), (0, _devServer2.default)()]);

  t.deepEqual(config.entry, {
    a: ['./a', 'webpack/hot/only-dev-server'],
    b: ['./b', 'webpack/hot/only-dev-server']
  });
});
//# sourceMappingURL=devServer.integration.test.js.map